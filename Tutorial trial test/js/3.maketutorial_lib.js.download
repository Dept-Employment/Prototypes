_walkmeWebpackJP([3],{55:function(n,t,i){(function(n){"use strict";var i=function(){function n(n,t,i){this._dataManagerWasInit=!1;this._siteConfigManager=n;this._clientOrServerStorageManager=t;this._commonUtils=i;this.AG_DATA_COOKIE_NAME=t.keysConfig.attentionGrabber.data.key}return n.prototype.updateSelection=function(n){this.selectedId=n;this.save()},n.prototype.updateEvent=function(){this._eventTimestamp=(new Date).getTime();this.save()},n.prototype.updateUnload=function(){this.unload=1;this.save()},n.prototype.init=function(){var n=this._clientOrServerStorageManager.getData(this.AG_DATA_COOKIE_NAME),t=(new Date).getTime(),r=this._siteConfigManager.get().Settings,i=parseInt(r.AGDataVersion)||0,u,f;n?(this._sessionTimestamp=t,this.sessionCounter=n.sc||1,this._version=this._commonUtils.isDefined(n.v)?n.v:i,this._shouldUpdateVersion=i>this._version,f=n.st?Math.abs(t-n.st):0,this._commonUtils.isLocalStorageEnabled()&&(u=window.localStorage.getItem(this._clientOrServerStorageManager.keysConfig.attentionGrabber.sessionLength.key)),this._sessionLength=parseFloat(u||r.AGSL||1440),this._shouldUpdateCounter=f/6e4>this._sessionLength,this.isNewSession=this._shouldUpdateCounter||this._shouldUpdateVersion,this.sessionCounter=this._shouldUpdateVersion?1:this._shouldUpdateCounter?this.sessionCounter+1:this.sessionCounter,this._version=this._shouldUpdateVersion?i:n.v,this.selectedId=this.isNewSession?void 0:n.id,this._eventTimestamp=this.isNewSession?t:n.et,this.unload=this.isNewSession?0:n.u,this.eventTimestampDelta=this._eventTimestamp?Math.abs(t-this._eventTimestamp):0):(this.isNewSession=!0,this._sessionTimestamp=t,this.sessionCounter=1,this._version=i,this._eventTimestamp=t,this.unload=0);this._dataManagerWasInit=!0;this.save()},n.prototype.save=function(){if(this._dataManagerWasInit){var n={st:this._sessionTimestamp,sc:this.sessionCounter,v:this._version,id:this.selectedId,et:this._eventTimestamp,u:this.unload};this._clientOrServerStorageManager.saveData(this.AG_DATA_COOKIE_NAME,n,this._clientOrServerStorageManager.keysConfig.attentionGrabber.data.expiry)}},n}();t.AttentionGrabberDataManager=i;n.register("AttentionGrabberDataManager").asCtor(i).dependencies("SiteConfigManager, ClientOrServerStorageManager, CommonUtils")}).call(t,i(2))},56:function(n,t,i){(function(n){"use strict";var r=function(){function t(n,t,i,r,u,f){this.commonUtils=f;this.NEW_CONTENT_PRIORITY=1e3;this._conditionTreeEvaluator=n;this._clientOrServerStorageManager=i;this._publishDataManager=r;this._logger=u;this._agDataManager=t}return t.prototype.init=function(n){var i,t,r;n.config&&n.player&&(this._config=n.config,this._player=n.player,this._menu=n.menu,i=this._config.Settings.AG,t=this._config.Settings.AGs,t&&t.length>0?(this._agDataManager.init(),this.initAllAGs(t)):i&&(r=this.create(n),r.setupAttenGrab()))},t.prototype.reset=function(){this._agData=this._agClass=this._config=this._player=this._menu=void 0},t.prototype.initAllAGs=function(n){var t,i;this._agDataManager.isNewSession?(1===this._agDataManager.sessionCounter&&this._publishDataManager.saveDataVersion(),t=this.getPotentialAGsForNewSession(n),t=t.sort(function(n,t){return n.Priority-t.Priority}),this.updateAGForNewSession(t)):this.updateAGForOldSession(n);this._agData?(this._logger.customerLog("Attention grabber - name: "+this._agData.Name+", settings:",3),this._logger.customerLog(this._agData.Settings,3)):this._logger.customerLog("Attention grabber: not selected",3);i="Attention grabber data: session counter = "+this._agDataManager.sessionCounter+", selected AG = "+this._agDataManager.selectedId+", unload AG = "+this._agDataManager.unload+", event timestamp delta = "+this._agDataManager.eventTimestampDelta/1e3+"s, session = "+this._agDataManager.isNewSession;this._logger.customerLog(i,4)},t.prototype.getPotentialAGsForNewSession=function(n){for(var t,u,i=[],f=this._agDataManager.sessionCounter,r=0;r<n.length;r++)t=n[r],u=t.Settings,this.shouldPlayAtSession(f,u)&&(parseInt(u.newContent)?this._publishDataManager.hasNewDeployables()&&(t.Priority-=this.NEW_CONTENT_PRIORITY,i.push(t)):i.push(t));return i},t.prototype.updateAGForNewSession=function(n){for(var i,r,u,t=0;t<n.length;t++)if((i=n[t],r=i.Settings,!r.conditions)||(u=this._conditionTreeEvaluator.evaluate(r.conditions),u))return this._agData=i,void this._agDataManager.updateSelection(i.Id)},t.prototype.updateAGForOldSession=function(n){for(var t,i,f,u=this._agDataManager.sessionCounter,r=0;r<n.length;r++)if(t=n[r],i=t.Settings,t.Id==this._agDataManager.selectedId){i=t.Settings;this.shouldPlayAtSession(u,i)&&this.shouldReplayAG(i)&&(i.conditions?(f=this._conditionTreeEvaluator.evaluate(i.conditions),f?(this._agData=t,this._agDataManager.updateSelection(t.Id)):this._logger.customerLog("Attention grabber conditions are not satisfied",5)):(this._agData=t,this._agDataManager.updateSelection(t.Id)));return}},t.prototype.shouldPlayAtSession=function(n,t){return!t||!this.commonUtils.isDefined(t.session)||!this.commonUtils.isDefined(t.interval)?!1:n<t.session?!1:n==t.session?!0:0==t.interval?!1:(n-t.session)%t.interval==0?!0:!1},t.prototype.shouldReplayAG=function(n){var t,i,r;return this._agDataManager.unload?!1:n?(t=this._agDataManager.eventTimestampDelta,i=parseInt(n.replay),!i||!t)?!1:(r=6e4*i,n.delay=t>r?0:(r-t)/1e3,!0):!1},t.prototype.load=function(){var n=this,t;this._agData&&(t={config:this._config,player:this._player,menu:this._menu,agData:this._agData},i.e(2,function(i){(function(r){var u=[i(57)];(function(){n._agClass=r.create("AttentionGrabber",t);n._agClass.setupAttenGrab()}).apply(null,u)}).call(this,i(2))}))},t.prototype.remove=function(n){if(!this._agClass)return void(n&&n());this._agDataManager.updateUnload();this._agClass.remove(n)},t.prototype.create=function(t){return this._config=t.config,this._player=t.player,this._agClass=n.create("AttentionGrabber",t),this._agClass},t.prototype.getImageAG=function(t){return this._config=t.config,this._player=t.player,this._agClass=n.create("ImageAttentionGrabber",t),this._agClass},t}();t.AttentionGrabberManager=r;n.register("AttentionGrabberManager").asCtor(r).dependencies("ConditionTreeEvaluator, AttentionGrabberDataManager, ClientOrServerStorageManager, PublishDataManager, Logger, CommonUtils, SiteConfigManager, Consts")}).call(t,i(2))}})