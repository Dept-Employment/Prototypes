var Midas;(function(n){var t;(function(t){var i=function(){function t(){var t=this;this.modelIdPrefix="#todoListItemModal";this.confirmAttendancePrefix="#ConfirmAttendance";this.modalBodyPrefix=".modal-body";this.referralCodes=[];this.ready=function(){var i=$("#ToDoListLoadingPanel").getAjaxLoadingPanel();i.bind(n.Core.AjaxLoadingPanel.loadedEventName,function(){n.Core.currentPage.initialise(i.element)});i.element.on("click",".todoItem",function(n){t.openCard(n)})};this.openCard=function(i){var h=$(i.currentTarget),c=h.data("event"),u=t.modelIdPrefix+c,o,f;t.modal=$(u).modal();o=t.modal.find(".modal-body p");f=t.modal.find("button[id^=ConfirmAttendance]");f.click(function(i){var r=t.modal.find(".modal-body");$.post($(i.target).attr("data-controlleractionurl"),{jobseekereventid:$(i.target).data("jobseekereventid")}).done(function(t){n.Core.AjaxValidation.processAjaxResult(t,r[0])&&(f.hide(),o.hide())});t.reloadList(u)});var s=t.modal.find(".modal-body"),r=s.find("[data-referral-action-id]"),l=r.attr("data-controlleractionurl"),e=[],a=r.attr("data-referral-action-id");$(r).is("button")&&t.initHideModal(function(){return t.restoreReferralTaskStates()});r.unbind("click");r.click(function(){e.length=0;$("[data-ref-id='"+a+"']").each(function(n,t){$(t).prop("checked")&&e.push($(t).attr("data-ref-code"))});var i={referralTypeCode:e.join("")};$.post(l,i).done(function(i){n.Core.AjaxValidation.processAjaxResult(i,s[0])&&(r.hide(),t.modal.find(".modal-body > *").not(":first,:last").hide(),t.reloadList(u))})})}}return t.prototype.initHideModal=function(n){this.modal.on("hidden.bs.modal",n())},t.prototype.reloadList=function(n){$(n).on("hidden.bs.modal",function(){var t=$(n).closest("[data-listview]"),i=t.getListView();i.dataSource.read()});this.captureReferralTaskStates()},t.prototype.captureReferralTaskStates=function(){var n=this,t=$("[data-referral-action-id]"),i=t.attr("data-referral-action-id");$("[data-ref-id='"+i+"']").each(function(t,i){n.referralCodes.push({id:$(i).attr("id"),refCode:$(i).attr("data-ref-code"),checked:$(i).is(":checked")})})},t.prototype.restoreReferralTaskStates=function(){$(this.referralCodes).each(function(n,t){var i=t.checked;$("#"+t.id+"").prop("checked",i)})},t.prototype.test=function(){$("#viewmoretodotasks").click(function(n){var t=$(n.currentTarget);$.post(t.data("controlleractionurl"))})},t}();t.ToDoListPanel=i})(t=n.Business||(n.Business={}))})(Midas||(Midas={}));$(function(){var n=new Midas.Business.ToDoListPanel;n.ready()})